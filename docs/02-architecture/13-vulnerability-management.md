# ğŸ›¡ï¸ GESTIÃ“N DE VULNERABILIDADES - Sistema IRCCA

**VersiÃ³n:** 1.0  
**Fecha:** 08-Oct-2025  
**PropÃ³sito:** Documentar el proceso de gestiÃ³n de vulnerabilidades en dependencias y cÃ³digo fuente para mantener el sistema seguro en producciÃ³n.

**Cumplimiento:** Requisito SO.1 - Marco de Ciberseguridad AGESIC

---

## ğŸ“‹ Resumen Ejecutivo

### ğŸ¯ Objetivo

Establecer un proceso sistemÃ¡tico para:
- âœ… Detectar vulnerabilidades en dependencias npm
- âœ… Priorizar y remediar segÃºn severidad
- âœ… Mantener registro de auditorÃ­as
- âœ… Prevenir introducciÃ³n de cÃ³digo vulnerable

---

## ğŸ” Herramientas de DetecciÃ³n

### **1. npm audit**

Herramienta oficial de npm que analiza el Ã¡rbol de dependencias contra la base de datos de vulnerabilidades conocidas.

**Comandos disponibles:**

```bash
# AuditorÃ­a bÃ¡sica (solo dependencias de producciÃ³n)
pnpm run audit

# AuditorÃ­a con correcciÃ³n automÃ¡tica
pnpm run audit:fix

# Generar reporte JSON
pnpm run audit:report

# VerificaciÃ³n completa (lint + audit)
pnpm run security:check
```

**ConfiguraciÃ³n:**

```json
{
  "scripts": {
    "audit": "npm audit --production",
    "audit:fix": "npm audit fix",
    "audit:report": "npm audit --json > audit-report.json",
    "security:check": "run-s lint:check audit"
  }
}
```

---

### **2. ESLint Security Plugin**

Plugin de seguridad estÃ¡tica que detecta patrones inseguros en el cÃ³digo.

**Reglas activas:**

```typescript
// eslint.config.ts
{
  'security/detect-unsafe-regex': 'error',          // CRÃTICO
  'security/detect-buffer-noassert': 'error',       // CRÃTICO
  'security/detect-eval-with-expression': 'error',  // CRÃTICO
  'security/detect-object-injection': 'warn',
  'security/detect-non-literal-regexp': 'warn',
  'security/detect-possible-timing-attacks': 'warn'
}
```

**EjecuciÃ³n:**

```bash
pnpm run lint       # Ejecutar y auto-corregir
pnpm run lint:check # Solo verificar sin modificar
```

---

### **3. TypeScript Strict Mode**

TypeScript en modo estricto previene vulnerabilidades por tipos incorrectos.

**ConfiguraciÃ³n:** `tsconfig.json`

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

**EjecuciÃ³n:**

```bash
pnpm run type-check
```

---

## ğŸ“Š Niveles de Severidad

### **ClasificaciÃ³n npm audit:**

| Severidad | DescripciÃ³n | AcciÃ³n Requerida | Tiempo |
|-----------|-------------|------------------|--------|
| **CRITICAL** | ExplotaciÃ³n remota, pÃ©rdida de datos | âš ï¸ INMEDIATA | < 24h |
| **HIGH** | Impacto significativo en seguridad | ğŸ”´ URGENTE | < 1 semana |
| **MODERATE** | Impacto limitado | ğŸŸ¡ PRIORITARIO | < 1 mes |
| **LOW** | Impacto mÃ­nimo | ğŸŸ¢ PLANIFICADO | PrÃ³ximo release |
| **INFO** | Sin impacto en seguridad | â„¹ï¸ OPCIONAL | A consideraciÃ³n |

---

## ğŸ”„ Proceso de GestiÃ³n

### **Fase 1: DetecciÃ³n (Semanal)**

**Cada lunes:**

```bash
# 1. Actualizar informaciÃ³n de vulnerabilidades
pnpm outdated

# 2. Ejecutar auditorÃ­a
pnpm run audit

# 3. Generar reporte si hay hallazgos
pnpm run audit:report
```

**AutomatizaciÃ³n (opcional):**

```bash
# Agregar a GitHub Actions o cron
0 9 * * 1  cd /path/to/project && pnpm run audit
```

---

### **Fase 2: AnÃ¡lisis y PriorizaciÃ³n**

**Cuando se detecta vulnerabilidad:**

1. **Verificar severidad**
   ```bash
   pnpm audit
   ```

2. **Revisar detalles**
   - DescripciÃ³n de la vulnerabilidad
   - Versiones afectadas
   - SoluciÃ³n disponible
   - Path de dependencia

3. **Evaluar impacto en el proyecto**
   - Â¿La funcionalidad vulnerable se usa?
   - Â¿Hay datos sensibles expuestos?
   - Â¿Es dependencia de producciÃ³n o desarrollo?

4. **Priorizar segÃºn matriz:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SEVERIDAD  â”‚  USO ACTIVO  â”‚  PRIORIDAD FINAL  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  CRITICAL   â”‚     SÃ       â”‚  âš ï¸ INMEDIATA     â”‚
â”‚  CRITICAL   â”‚     NO       â”‚  ğŸ”´ URGENTE       â”‚
â”‚  HIGH       â”‚     SÃ       â”‚  ğŸ”´ URGENTE       â”‚
â”‚  HIGH       â”‚     NO       â”‚  ğŸŸ¡ PRIORITARIO   â”‚
â”‚  MODERATE   â”‚     SÃ       â”‚  ğŸŸ¡ PRIORITARIO   â”‚
â”‚  MODERATE   â”‚     NO       â”‚  ğŸŸ¢ PLANIFICADO   â”‚
â”‚  LOW/INFO   â”‚     -        â”‚  ğŸŸ¢ PLANIFICADO   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Fase 3: RemediaciÃ³n**

**OpciÃ³n A: ActualizaciÃ³n automÃ¡tica**

```bash
# Intenta corregir automÃ¡ticamente
pnpm run audit:fix

# Verifica que no se rompiÃ³ nada
pnpm run test:all
pnpm run build
```

**OpciÃ³n B: ActualizaciÃ³n manual**

```bash
# Actualizar paquete especÃ­fico
pnpm update <paquete>@latest

# O editar package.json y reinstalar
pnpm install
```

**OpciÃ³n C: Alternativa**

Si no hay actualizaciÃ³n disponible:

```bash
# Buscar paquete alternativo
pnpm search <alternativa>

# Instalar reemplazo
pnpm remove <paquete-vulnerable>
pnpm add <paquete-alternativo>
```

**OpciÃ³n D: MitigaciÃ³n temporal**

Si no es posible actualizar inmediatamente:

1. Documentar el riesgo
2. Implementar controles compensatorios
3. Planificar actualizaciÃ³n en siguiente sprint

---

### **Fase 4: VerificaciÃ³n**

**DespuÃ©s de remediar:**

```bash
# 1. Verificar que se solucionÃ³
pnpm run audit

# 2. Ejecutar suite de tests
pnpm run test:all

# 3. Verificar type-checking
pnpm run type-check

# 4. Ejecutar lint
pnpm run lint:check

# 5. Build de producciÃ³n
pnpm run build
```

**Si todo pasa:**
âœ… Commit y push
```bash
git add package.json pnpm-lock.yaml
git commit -m "security: fix vulnerability in <paquete>"
git push
```

---

### **Fase 5: DocumentaciÃ³n**

**Registrar en:** `docs/03-security/vulnerability-log.md`

```markdown
## [2025-10-08] Vulnerabilidad en <paquete>

**Severidad:** HIGH  
**CVE:** CVE-2024-XXXXX  
**DescripciÃ³n:** <descripciÃ³n breve>

**AcciÃ³n tomada:**
- Actualizado <paquete> de v1.0.0 a v1.2.0
- Tests ejecutados: âœ… PASS
- Build verificado: âœ… OK

**Verificado por:** Mario BERNI  
**Fecha de resoluciÃ³n:** 2025-10-08
```

---

## ğŸš« Dependencias Prohibidas

### **Lista de paquetes NO permitidos:**

```javascript
// âŒ PROHIBIDO - Usar en su lugar:
'eval'              // âŒ NO usar nunca
'Function()'        // âŒ NO usar nunca
'vm'                // âŒ MÃ³dulo peligroso (Node.js)
'child_process'     // âŒ EjecuciÃ³n de comandos (Node.js)

// âš ï¸ EVITAR - Buscar alternativas:
'lodash'            // âš ï¸ Usar @vueuse/core o nativo ES6
'moment'            // âš ï¸ Usar date-fns o nativo Date
'request'           // âš ï¸ Deprecated, usar fetch o axios
```

### **Criterios para agregar nueva dependencia:**

```
âœ… Checklist antes de `pnpm add <paquete>`:

[ ] Â¿Es realmente necesario?
[ ] Â¿Puedo lograrlo con cÃ³digo nativo?
[ ] Â¿EstÃ¡ activamente mantenido? (commit en Ãºltimos 6 meses)
[ ] Â¿Tiene buena reputaciÃ³n? (>1000 descargas semanales)
[ ] Â¿No tiene vulnerabilidades conocidas?
[ ] Â¿Licencia compatible? (MIT, Apache, BSD)
[ ] Â¿TypeScript support?
[ ] Â¿Tests incluidos?
```

---

## ğŸ“… Calendario de AuditorÃ­as

### **Frecuencia:**

| Actividad | Frecuencia | Responsable | Herramienta |
|-----------|------------|-------------|-------------|
| **AuditorÃ­a de dependencias** | Semanal (lunes) | Custodio TÃ©cnico | `pnpm audit` |
| **RevisiÃ³n de outdated** | Mensual | Custodio TÃ©cnico | `pnpm outdated` |
| **ActualizaciÃ³n preventiva** | Trimestral | Custodio TÃ©cnico | `pnpm update` |
| **AuditorÃ­a de cÃ³digo** | Cada commit | AutomÃ¡tico | ESLint Security |
| **RevisiÃ³n manual** | Cada PR/merge | Custodio TÃ©cnico | Code Review |

### **Eventos especiales:**

- **Nueva CVE crÃ­tica publicada:** AuditorÃ­a inmediata
- **Antes de cada release:** AuditorÃ­a completa + reporte
- **DespuÃ©s de agregar dependencia:** AuditorÃ­a + tests

---

## ğŸ“ˆ MÃ©tricas de Seguridad

### **KPIs a monitorear:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MÃ‰TRICA                    â”‚  OBJETIVO  â”‚  ACTUAL   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Vulnerabilidades CRITICAL  â”‚     0      â”‚    âœ… 0   â”‚
â”‚  Vulnerabilidades HIGH      â”‚     0      â”‚    âœ… 0   â”‚
â”‚  Vulnerabilidades MODERATE  â”‚    < 3     â”‚    âœ… 0   â”‚
â”‚  Tiempo respuesta CRITICAL  â”‚   < 24h    â”‚    âœ…     â”‚
â”‚  Tiempo respuesta HIGH      â”‚  < 1 sem   â”‚    âœ…     â”‚
â”‚  Dependencias outdated      â”‚    < 5     â”‚    ğŸ“Š     â”‚
â”‚  Ãšltima auditorÃ­a           â”‚  < 7 dÃ­as  â”‚    âœ…     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Comando para verificar:**

```bash
# Estado actual
pnpm audit

# Dependencias desactualizadas
pnpm outdated

# Ãšltimo commit de seguridad
git log --grep="security" -n 1
```

---

## ğŸ” IntegraciÃ³n Continua

### **Pre-commit Hook (Opcional)**

```bash
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Ejecutar lint y audit antes de commit
pnpm run lint:check
pnpm run audit
```

### **GitHub Actions (Recomendado)**

```yaml
# .github/workflows/security.yml
name: Security Audit

on:
  push:
    branches: [main]
  pull_request:
  schedule:
    - cron: '0 9 * * 1'  # Cada lunes 9am

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install --frozen-lockfile
      - run: pnpm audit --production
      - run: pnpm run lint:check
```

---

## ğŸ“ Procedimiento de Emergencia

### **Si se descubre vulnerabilidad CRITICAL en producciÃ³n:**

**Paso 1: EvaluaciÃ³n inmediata (< 1 hora)**

```bash
# 1. Reproducir vulnerabilidad
pnpm audit

# 2. Verificar si afecta al sistema
# - Â¿Funcionalidad vulnerable en uso?
# - Â¿Datos sensibles expuestos?
# - Â¿Vector de ataque disponible?
```

**Paso 2: ContenciÃ³n (< 2 horas)**

```bash
# OpciÃ³n A: Desplegar hotfix
pnpm run audit:fix
pnpm run test:all
pnpm run build
# Desplegar inmediatamente

# OpciÃ³n B: Deshabilitar funcionalidad
# Si no hay fix disponible, deshabilitar feature afectada
```

**Paso 3: ComunicaciÃ³n (< 3 horas)**

```markdown
# Notificar a:
- âœ… DirecciÃ³n del IRCCA
- âœ… Usuario administrador del sistema
- âœ… AGESIC (si aplica por normativa)

# Template de comunicaciÃ³n:
Asunto: [URGENTE] Vulnerabilidad de seguridad detectada

Se detectÃ³ una vulnerabilidad CRITICAL en dependencia <paquete>.
- Impacto: <descripciÃ³n>
- AcciÃ³n tomada: <correcciÃ³n aplicada>
- Estado actual: <resuelto/en proceso>
```

**Paso 4: RemediaciÃ³n definitiva (< 24 horas)**

```bash
# Actualizar dependencia
pnpm update <paquete>@latest

# Suite completa de verificaciÃ³n
pnpm run security:check
pnpm run test:all
pnpm run build

# Desplegar a producciÃ³n
git commit -m "security(critical): fix CVE-XXXX in <paquete>"
git push
```

**Paso 5: Post-mortem (< 48 horas)**

Documentar en `docs/03-security/incident-YYYY-MM-DD.md`:
- QuÃ© pasÃ³
- CÃ³mo se detectÃ³
- Impacto real
- CÃ³mo se solucionÃ³
- Lecciones aprendidas
- Mejoras a implementar

---

## ğŸ“š Referencias y Recursos

### **Bases de datos de vulnerabilidades:**

- **npm Advisory:** https://www.npmjs.com/advisories
- **Snyk Vulnerability DB:** https://security.snyk.io/
- **GitHub Advisory:** https://github.com/advisories
- **CVE:** https://cve.mitre.org/
- **NVD (NIST):** https://nvd.nist.gov/

### **Herramientas adicionales (opcional):**

```bash
# Snyk (mÃ¡s completo que npm audit)
npx snyk test

# Retire.js (vulnerabilidades en JavaScript)
npx retire

# OWASP Dependency Check
# (para proyectos mÃ¡s grandes)
```

---

## âœ… Checklist de Cumplimiento

**Para auditorÃ­a AGESIC:**

```markdown
[ ] âœ… Proceso documentado formalmente
[ ] âœ… Herramientas de detecciÃ³n configuradas
[ ] âœ… Calendario de auditorÃ­as establecido
[ ] âœ… Scripts automatizados creados
[ ] âœ… Procedimiento de emergencia definido
[ ] âœ… Registro de vulnerabilidades mantenido
[ ] âœ… Responsable designado (Custodio TÃ©cnico)
[ ] âœ… VerificaciÃ³n en cada commit (ESLint Security)
[ ] âœ… Estado actual: 0 vulnerabilidades crÃ­ticas/altas
```

---

## ğŸ“ Control de Versiones

| VersiÃ³n | Fecha | Autor | Cambios |
|---------|-------|-------|---------|
| 1.0 | 08-Oct-2025 | Mario BERNI | VersiÃ³n inicial - Cumplimiento SO.1 |

---

**Custodio TÃ©cnico:** Mario BERNI  
**PrÃ³xima revisiÃ³n:** 08-Ene-2026
